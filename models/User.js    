const mongoose = require('mongoose');

const userSchema = new mongoose.Schema(
  {
    username: {
      type: String,
      required: true,
      unique: true,
      trim: true
    },
    email: {
      type: String,
      required: true,
      unique: true,
      lowercase: true
    },
    passwordHash: {
      type: String,
      required: true // b·∫£o m·∫≠t (ƒë√£ m√£ h√≥a tr∆∞·ªõc khi l∆∞u)
    },

    // Th√¥ng tin ph·ª• (profile)
    profile: {
      fullName: { type: String, default: '' },
      phone: { type: String, default: '' }
    },

    // üõí Tham chi·∫øu 1-1: Gi·ªè h√†ng (Cart)
    cart: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'Cart'
    },

    // üì¶ Tham chi·∫øu N-N: danh s√°ch c√°c Order ID
    orders: [
      {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'Order'
      }
    ],

    // üíù Tham chi·∫øu 1-1: Wishlist c·ªßa ng∆∞·ªùi d√πng
    wishlist: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'Wishlist'
    },

    // üìù Tham chi·∫øu N-N: Review m√† user ƒë√£ vi·∫øt (t√πy ch·ªçn)
    reviews: [
      {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'Review'
      }
    ],

    // ‚öôÔ∏è Ph√¢n quy·ªÅn
    role: {
      type: String,
      enum: ['user', 'admin'],
      default: 'user'
    }
  },
  { timestamps: true }
);

module.exports = mongoose.model('User', userSchema);
